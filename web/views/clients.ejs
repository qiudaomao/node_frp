<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clients - FRP Admin</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="nav-brand">FRP Admin</a>
      <ul class="nav-menu">
        <li><a href="/">Dashboard</a></li>
        <li><a href="/clients" class="active">Clients</a></li>
        <li><a href="/port-forwards">Port Forwards</a></li>
        <li><a href="/logout">Logout</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <div class="page-header">
      <h1>Clients</h1>
      <a href="/clients/new" class="btn btn-primary">Add Client</a>
    </div>

    <% if (clients.length > 0) { %>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Description</th>
              <th>Token</th>
              <th>Status</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% clients.forEach(function(client) { %>
              <tr>
                <td><%= client.name %></td>
                <td><%= client.description || '-' %></td>
                <td><code><%= client.token.substring(0, 16) %>...</code></td>
                <td>
                  <span class="status <%= client.enabled ? 'status-active' : 'status-inactive' %>">
                    <%= client.enabled ? 'Active' : 'Inactive' %>
                  </span>
                </td>
                <td><%= new Date(client.created_at).toLocaleDateString() %></td>
                <td>
                  <a href="/clients/<%= client.id %>" class="btn btn-sm">View</a>
                  <a href="/clients/<%= client.id %>/edit" class="btn btn-sm">Edit</a>
                  <button class="btn btn-sm btn-danger" onclick="deleteClient(<%= client.id %>, '<%= client.name %>')">Delete</button>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <div class="empty-state">
        <h3>No clients configured</h3>
        <p>Create your first client to start managing port forwards.</p>
        <a href="/clients/new" class="btn btn-primary">Add Client</a>
      </div>
    <% } %>
  </main>

  <script>
    async function deleteClient(id, name) {
      if (confirm(`Are you sure you want to delete client "${name}"? This will also delete all associated port forwards.`)) {
        try {
          const response = await fetch(`/api/clients/${id}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            }
          });

          if (response.ok) {
            window.location.reload();
          } else {
            const error = await response.json();
            alert('Failed to delete client: ' + error.error);
          }
        } catch (err) {
          alert('Error deleting client: ' + err.message);
        }
      }
    }
  </script>

  <footer class="footer">
    <p>&copy; 2025 FRP Server Admin Panel</p>
  </footer>
</body>
</html>